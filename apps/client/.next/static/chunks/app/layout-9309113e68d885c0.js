(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{1354:function(e,t,r){Promise.resolve().then(r.t.bind(r,9974,23)),Promise.resolve().then(r.bind(r,9064)),Promise.resolve().then(r.bind(r,1245)),Promise.resolve().then(r.t.bind(r,9268,23))},1245:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return i},QO:function(){return d},TE:function(){return h},aC:function(){return l}});var n=r(7437),s=r(2265),o=r(9376),a=r(9064),u=r(1837);let c=(0,s.createContext)(void 0);function i(e){let{children:t}=e,[r,i]=(0,s.useState)(null),[l,d]=(0,s.useState)(null),[h,p]=(0,s.useState)(!0),g=(0,o.useRouter)();(0,s.useEffect)(()=>{(async()=>{let e=(0,u.bW)();if(e){d(e);try{let e=await u.x1.auth.me();e.success?i(e.data):((0,u.yE)(),d(null))}catch(e){(0,u.yE)(),d(null)}}p(!1)})()},[]);let m=async(e,t)=>{try{p(!0);let r=await u.x1.auth.login(e,t);if(r.success){let{user:e,token:t,refresh_token:n}=r.data;(0,u.uB)(t),(0,u.zI)(n),i(e),d(t),a.Am.success("Login successful!"),g.push("/dashboard")}else throw Error(r.message||"Login failed")}catch(t){var r,n;let e=(null===(n=t.response)||void 0===n?void 0:null===(r=n.data)||void 0===r?void 0:r.message)||t.message||"Login failed";throw a.Am.error(e),t}finally{p(!1)}},f=async e=>{try{p(!0);let t=await u.x1.auth.register(e);if(t.success){let{user:e,token:r,refresh_token:n}=t.data;(0,u.uB)(r),(0,u.zI)(n),i(e),d(r),a.Am.success("Registration successful!"),g.push("/dashboard")}else throw Error(t.message||"Registration failed")}catch(n){var t,r;let e=(null===(r=n.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||n.message||"Registration failed";throw a.Am.error(e),n}finally{p(!1)}},v=async()=>{try{await u.x1.auth.logout()}catch(e){}finally{(0,u.yE)(),i(null),d(null),a.Am.success("Logged out successfully"),g.push("/auth/login")}};return(0,n.jsx)(c.Provider,{value:{user:r,token:l,login:m,register:f,logout:v,isLoading:h,isAuthenticated:!!r&&!!l},children:t})}function l(){let e=(0,s.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function d(e){return function(t){let{isAuthenticated:r,isLoading:a}=l(),u=(0,o.useRouter)();return((0,s.useEffect)(()=>{a||r||u.push("/auth/login")},[r,a,u]),a)?(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):r?(0,n.jsx)(e,{...t}):null}}function h(){let{user:e}=l(),t=t=>(null==e?void 0:e.role)===t,r=t=>t.includes((null==e?void 0:e.role)||"");return{user:e,hasRole:t,hasAnyRole:r,isAdmin:()=>t("admin"),isManager:()=>t("manager"),isUser:()=>t("user"),canManageProducts:()=>r(["admin","manager"]),canManageInventory:()=>r(["admin","manager","user"]),canViewReports:()=>r(["admin","manager"]),canManageUsers:()=>t("admin")}}},1837:function(e,t,r){"use strict";r.d(t,{bW:function(){return l},uB:function(){return c},x1:function(){return u},yE:function(){return d},zI:function(){return i}});var n=r(3464),s=r(4131),o=r(9064);let a=n.Z.create({baseURL:"http://localhost:8080/api",timeout:3e4,headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>{let t=s.Z.get("auth_token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),a.interceptors.response.use(e=>e,e=>{if(e.response){let{status:t,data:r}=e.response;switch(t){case 401:s.Z.remove("auth_token"),s.Z.remove("refresh_token"),window.location.href="/auth/login";break;case 403:o.Am.error("Access denied. You do not have permission to perform this action.");break;case 429:o.Am.error("Too many requests. Please try again later.");break;case 500:o.Am.error("Server error. Please try again later.");break;default:r&&"object"==typeof r&&"message"in r?o.Am.error(r.message):o.Am.error("An unexpected error occurred.")}}else e.request?o.Am.error("Network error. Please check your connection."):o.Am.error("An unexpected error occurred.");return Promise.reject(e)});let u={get:(e,t)=>a.get(e,{params:t}).then(e=>e.data),post:(e,t)=>a.post(e,t).then(e=>e.data),put:(e,t)=>a.put(e,t).then(e=>e.data),patch:(e,t)=>a.patch(e,t).then(e=>e.data),delete:e=>a.delete(e).then(e=>e.data),auth:{login:(e,t)=>u.post("/auth/login",{email:e,password:t}),register:e=>u.post("/auth/register",e),logout:()=>u.post("/auth/logout"),me:()=>u.get("/auth/me"),refreshToken:e=>u.post("/auth/refresh",{refresh_token:e})},products:{list:e=>u.get("/products",e),get:e=>u.get("/products/".concat(e)),create:e=>u.post("/products",e),update:(e,t)=>u.patch("/products/".concat(e),t),delete:e=>u.delete("/products/".concat(e)),search:e=>u.get("/products/search?q=".concat(e))},units:{list:()=>u.get("/units"),create:e=>u.post("/units",e),update:(e,t)=>u.put("/units/".concat(e),t),delete:e=>u.delete("/units/".concat(e))},inventory:{list:e=>u.get("/inventory",e),getByProduct:e=>u.get("/inventory/product/".concat(e)),add:e=>u.post("/inventory/add",e),reduce:e=>u.post("/inventory/reduce",e),getLogs:e=>u.get("/inventory/logs",e)},batches:{create:e=>u.post("/batches",e),get:e=>u.get("/batches/".concat(e)),update:(e,t)=>u.put("/batches/".concat(e),t)},reports:{lowStock:e=>u.get("/reports/low-stock",{threshold:e}),expiringBatches:e=>u.get("/reports/expiring-batches",{days:e}),inventoryValue:()=>u.get("/reports/inventory-value"),dashboardStats:()=>u.get("/reports/dashboard-stats")}},c=e=>{s.Z.set("auth_token",e,{expires:7})},i=e=>{s.Z.set("refresh_token",e,{expires:30})},l=()=>s.Z.get("auth_token"),d=()=>{s.Z.remove("auth_token"),s.Z.remove("refresh_token")}},9268:function(){},9974:function(e){e.exports={style:{fontFamily:"'__Inter_e8ce0c', '__Inter_Fallback_e8ce0c'",fontStyle:"normal"},className:"__className_e8ce0c"}}},function(e){e.O(0,[799,610,971,117,744],function(){return e(e.s=1354)}),_N_E=e.O()}]);