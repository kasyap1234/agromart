(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{9695:function(e,t,r){Promise.resolve().then(r.bind(r,6117))},6117:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var s=r(7437),n=r(2265),a=r(9376),o=r(1245);function u(){let{isAuthenticated:e,isLoading:t}=(0,o.aC)(),r=(0,a.useRouter)();return(0,n.useEffect)(()=>{t||(e?r.push("/dashboard"):r.push("/auth/login"))},[e,t,r]),(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-primary-50 to-primary-100",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto mb-4"}),(0,s.jsx)("h2",{className:"text-lg font-semibold text-neutral-700",children:"Loading AgroMart..."}),(0,s.jsx)("p",{className:"text-neutral-500 mt-2",children:"Please wait while we prepare your dashboard"})]})})}},1245:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return c},QO:function(){return d},TE:function(){return h},aC:function(){return l}});var s=r(7437),n=r(2265),a=r(9376),o=r(9064),u=r(1837);let i=(0,n.createContext)(void 0);function c(e){let{children:t}=e,[r,c]=(0,n.useState)(null),[l,d]=(0,n.useState)(null),[h,p]=(0,n.useState)(!0),g=(0,a.useRouter)();(0,n.useEffect)(()=>{(async()=>{let e=(0,u.bW)();if(e){d(e);try{let e=await u.x1.auth.me();e.success?c(e.data):((0,u.yE)(),d(null))}catch(e){(0,u.yE)(),d(null)}}p(!1)})()},[]);let m=async(e,t)=>{try{p(!0);let r=await u.x1.auth.login(e,t);if(r.success){let{user:e,token:t,refresh_token:s}=r.data;(0,u.uB)(t),(0,u.zI)(s),c(e),d(t),o.Am.success("Login successful!"),g.push("/dashboard")}else throw Error(r.message||"Login failed")}catch(t){var r,s;let e=(null===(s=t.response)||void 0===s?void 0:null===(r=s.data)||void 0===r?void 0:r.message)||t.message||"Login failed";throw o.Am.error(e),t}finally{p(!1)}},f=async e=>{try{p(!0);let t=await u.x1.auth.register(e);if(t.success){let{user:e,token:r,refresh_token:s}=t.data;(0,u.uB)(r),(0,u.zI)(s),c(e),d(r),o.Am.success("Registration successful!"),g.push("/dashboard")}else throw Error(t.message||"Registration failed")}catch(s){var t,r;let e=(null===(r=s.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||s.message||"Registration failed";throw o.Am.error(e),s}finally{p(!1)}},v=async()=>{try{await u.x1.auth.logout()}catch(e){}finally{(0,u.yE)(),c(null),d(null),o.Am.success("Logged out successfully"),g.push("/auth/login")}};return(0,s.jsx)(i.Provider,{value:{user:r,token:l,login:m,register:f,logout:v,isLoading:h,isAuthenticated:!!r&&!!l},children:t})}function l(){let e=(0,n.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function d(e){return function(t){let{isAuthenticated:r,isLoading:o}=l(),u=(0,a.useRouter)();return((0,n.useEffect)(()=>{o||r||u.push("/auth/login")},[r,o,u]),o)?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):r?(0,s.jsx)(e,{...t}):null}}function h(){let{user:e}=l(),t=t=>(null==e?void 0:e.role)===t,r=t=>t.includes((null==e?void 0:e.role)||"");return{user:e,hasRole:t,hasAnyRole:r,isAdmin:()=>t("admin"),isManager:()=>t("manager"),isUser:()=>t("user"),canManageProducts:()=>r(["admin","manager"]),canManageInventory:()=>r(["admin","manager","user"]),canViewReports:()=>r(["admin","manager"]),canManageUsers:()=>t("admin")}}},1837:function(e,t,r){"use strict";r.d(t,{bW:function(){return l},uB:function(){return i},x1:function(){return u},yE:function(){return d},zI:function(){return c}});var s=r(3464),n=r(4131),a=r(9064);let o=s.Z.create({baseURL:"http://localhost:8080/api",timeout:3e4,headers:{"Content-Type":"application/json"}});o.interceptors.request.use(e=>{let t=n.Z.get("auth_token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),o.interceptors.response.use(e=>e,e=>{if(e.response){let{status:t,data:r}=e.response;switch(t){case 401:n.Z.remove("auth_token"),n.Z.remove("refresh_token"),window.location.href="/auth/login";break;case 403:a.Am.error("Access denied. You do not have permission to perform this action.");break;case 429:a.Am.error("Too many requests. Please try again later.");break;case 500:a.Am.error("Server error. Please try again later.");break;default:r&&"object"==typeof r&&"message"in r?a.Am.error(r.message):a.Am.error("An unexpected error occurred.")}}else e.request?a.Am.error("Network error. Please check your connection."):a.Am.error("An unexpected error occurred.");return Promise.reject(e)});let u={get:(e,t)=>o.get(e,{params:t}).then(e=>e.data),post:(e,t)=>o.post(e,t).then(e=>e.data),put:(e,t)=>o.put(e,t).then(e=>e.data),patch:(e,t)=>o.patch(e,t).then(e=>e.data),delete:e=>o.delete(e).then(e=>e.data),auth:{login:(e,t)=>u.post("/auth/login",{email:e,password:t}),register:e=>u.post("/auth/register",e),logout:()=>u.post("/auth/logout"),me:()=>u.get("/auth/me"),refreshToken:e=>u.post("/auth/refresh",{refresh_token:e})},products:{list:e=>u.get("/products",e),get:e=>u.get("/products/".concat(e)),create:e=>u.post("/products",e),update:(e,t)=>u.patch("/products/".concat(e),t),delete:e=>u.delete("/products/".concat(e)),search:e=>u.get("/products/search?q=".concat(e))},units:{list:()=>u.get("/units"),create:e=>u.post("/units",e),update:(e,t)=>u.put("/units/".concat(e),t),delete:e=>u.delete("/units/".concat(e))},inventory:{list:e=>u.get("/inventory",e),getByProduct:e=>u.get("/inventory/product/".concat(e)),add:e=>u.post("/inventory/add",e),reduce:e=>u.post("/inventory/reduce",e),getLogs:e=>u.get("/inventory/logs",e)},batches:{create:e=>u.post("/batches",e),get:e=>u.get("/batches/".concat(e)),update:(e,t)=>u.put("/batches/".concat(e),t)},reports:{lowStock:e=>u.get("/reports/low-stock",{threshold:e}),expiringBatches:e=>u.get("/reports/expiring-batches",{days:e}),inventoryValue:()=>u.get("/reports/inventory-value"),dashboardStats:()=>u.get("/reports/dashboard-stats")}},i=e=>{n.Z.set("auth_token",e,{expires:7})},c=e=>{n.Z.set("refresh_token",e,{expires:30})},l=()=>n.Z.get("auth_token"),d=()=>{n.Z.remove("auth_token"),n.Z.remove("refresh_token")}}},function(e){e.O(0,[610,971,117,744],function(){return e(e.s=9695)}),_N_E=e.O()}]);